<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="/css/product.css" /> 
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script>
        function removeItem(self, id) {
            //alert(id);
            let removeddiv = $(self).parent().parent().parent();
            console.log(removeddiv.html());
            removeddiv.remove();
            
            $.ajax({
                "url": "product/removeitem",
                "method": "GET",
                "data":{id: id}
            }).done(function(response){
                console.log(response);
                $("#spannoofitem").html("(" + response.noofitem + " items)");
                $("#subtotal").html(response.subtotal);
            })
            
        }

        function changeQuantity(self, id, num) {

            $.ajax({
                "url": "changequantity",
                "method": "GET",
                "data":{id: id, num: num}
            }).done(function(response){
                console.log(response);
                $("#spannoofitem").html("(" + response.noofitem + " items)");
                $("#subtotal").html(response.subtotal);
                if(response.action == "remove") {
                    let removeddiv = $(self).parent().parent().parent();
                    console.log(removeddiv.html());
                    removeddiv.remove();
                } else {
                    console.log($(self).parent().children('span').html());
                    $(self).parent().children('span').html(response.newquantity);
                }
            })       
               
        }
    </script>
    <title>Document</title>
</head>
<body>
    <div>
        <div style="margin: 0 auto;max-width: 1440px;width: 90%;padding-left: 20px;padding-right: 20px;">
            <div style="display: flex;flex-wrap: wrap;">
                <div style="width: 66.6666666667%; flex: 0 0 auto; box-sizing: border-box;
                padding-right: 0.75rem; padding-left: 0.75rem;">
                    <!-- large box with border radious-->
                    <div class="flexcolumn" style="box-sizing: border-box; margin: 0 auto 1.5rem;
                        box-shadow: 0 0.0625rem 0.125rem 0.0625rem #00000026;border-radius: 0.5rem;">
                        <!--first div with bg-->
                        <div style="border-color: #f1f1f2;box-sizing: border-box; padding-bottom: 1rem;background-color: #f2f8fd;
                            border-color: #f1f1f2;border-bottom-style: solid; border-bottom-width: 1px; font-size: 1.75rem; font-weight: 700; padding: 20px;">                           
                                Cart                           
                        </div>
                        <!--items-->
                        <div clas="flexcolumn">
                            <!--number of item-->
                            <div style="padding-left: 1.5rem;padding-right: 1.5rem;margin-top: 1rem;justify-content: space-between;align-items: center; box-sizing: border-box;">
                                <div style="font-size: 1.125rem;font-weight: 700;">
                                    <span id="spannoofitem1"><%= noofitem %></span> items
                                </div>
                            </div>
                            <!-- list of items in cart-->
                            <section>
                                <% for(let i = 0; i< cart.length; i++) {%>
                                <div class="flexcolumn" style="box-sizing: border-box; margin: 0.5rem; position: relative;border-top: 1px solid #f1f1f2;">
                                    <div style="display: flex;position: relative;padding-top: 0.25rem;">
                                        <div style="margin-top: 0.25rem;margin-bottom: 1rem;;display: flex;box-sizing: border-box;">
                                            <a>
                                                <img src="/images/i15.jpeg" height="96px" width="96px"/>
                                            </a>
                                        </div>
                                        <div style="display: flex;width: 60%;box-sizing: border-box;color: #2e2f32; padding-top: 10px;">
                                            <span><%= cart[i].title %></span>
                                        </div>
                                        <div style="text-align: right;line-height: 1.25;font-size: 1.125rem;font-weight: 700;box-sizing: border-box; padding-top: 10px; width: 30%; padding-right: 10px;">
                                            $<%= cart[i].price %>
                                        </div>
                                    </div>
                                    <!--remove-->
                                    <div style="right: 0px; bottom: -8px; position: absolute;margin-left: auto;margin-bottom: 0.5rem;margin-top: 0.5rem;display: flex;align-items: center; gap: 15px;">
                                        
                                        <div>
                                            <a class="btn" style="text-align: center; text-decoration: underline;cursor: pointer;" onclick="removeItem(this, '1');">
                                                Remove
                                            </a>                                       
                                        </div>
                                        <div style="width: 120px;padding: 0.25rem;display: flex;border-radius: 9999px; border: 1px solid #babbbe; font-size: 1rem;">
                                            <button class="btn quantity-change" onclick="changeQuantity(this, '<%=cart[i].id %>', -1);">
                                                -</button>
                                                <span id="spanquantity" style="margin: 0 auto; display: flex; align-items: center;font-weight: 700;">
                                                    <%= cart[i].quantity %>
                                                </span>
                                            <button class="btn quantity-change" onclick="changeQuantity(this, '<%=cart[i].id %>', 1);">
                                                +</button>
                                        </div>
                                        
                                    </div>
                                    
                                </div>
                                <% } %>
                            </section>

                        </div>

                    </div>
                </div>
                <div style="width: 33.3333333333%; flex: 0 0 auto; border: 1px solid #e3e4e5; border-radius: 8px; padding: 1rem; box-sizing: border-box;">
                    <div style="position: sticky; top: 115px;">
                        <!--div with border-->
                        <div style="box-shadow: 0 0.0625rem 0.125rem 0.0625rem #00000026; border-radius: 0.5rem;">
                            <div style="display: flex;flex-direction: column;margin: 0 auto; padding-left: 1rem;padding-right: 1rem;">
                                <!--Subtotal-->
                                <div style="display: flex; justify-content: space-between;align-items: center; padding-top: 1rem;">
                                    <span style="font-weight: 700;">
                                        Subtotal
                                        <span id="spannoofitem" style="font-weight: 400;margin-left: 0.25rem;">(<%= noofitem %> items)</span>
                                    </span>
                                    <div style="width: 50%;display: flex; flex-direction: column;align-items: flex-end; ">
                                        <div id="subtotal">$<%= subtotal %></div>
                                    </div>
                                </div>
                                <!--Shipping-->
                                <div style="display: flex; justify-content: space-between;align-items: center;padding-top: 0.25rem;">
                                    <span>Shipping</span>
                                    <div>$5</div>
                                </div>
                                <!--estimated -->
                                <div style="display: flex;justify-content: space-between;align-items: center;font-weight: 700;padding-bottom: 1rem;padding-top: 1rem;box-sizing: border-box;;">
                                    <label>Estimated total</label>
                                    <div id="estotal" style="font-size: 1.125rem;">$<%= subtotal + 5 %></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
    </div>
    <input type="hidden" name="id" value=""/>
</body>
</html>